---
import type { Props } from './dist/utils'
import { generateFonts, createFontCSS, createBaseCSS, createPreloads, getPreloadType } from './dist/utils'

const { config } = Astro.props as Props

const resolvedConfig = await generateFonts(config)

const preloads = resolvedConfig.map(createPreloads).flat()
const baseCSS = await Promise.all(resolvedConfig.map(createBaseCSS))
const fallbackCSS = (await Promise.all(resolvedConfig.map(createFontCSS))).flat()
---

{preloads.map((content) => <link as="font" crossorigin rel="preload" href={content} type={getPreloadType(content)} />)}
{baseCSS.map((content) => <style set:html={content} is:inline />)}
{fallbackCSS.map((content) => <style set:html={content} is:inline />)}
