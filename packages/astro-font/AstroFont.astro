---
import type { Props } from "./utils";
import {
  generateFonts,
  createFontCSS,
  createBaseCSS,
  createPreloads,
  getPreloadType,
} from "./utils";

const { config } = Astro.props as Props;

const config_1 = await generateFonts(config);

const preloads = config_1
  .filter((i) => i.preload)
  .map((entry) => createPreloads(entry))
  .flat();
const baseCSS = await Promise.all(
  config_1.map((entry) => createBaseCSS(entry))
);
const fallbackCSS = (
  await Promise.all(config_1.map((entry) => createFontCSS(entry)))
).flat();
---

{
  preloads.map((content) => (
    <link
      as="font"
      crossorigin
      rel="preload"
      href={content}
      type={getPreloadType(content)}
    />
  ))
}
{baseCSS.map((content) => <style set:html={content} is:inline />)}
{fallbackCSS.map((content) => <style set:html={content} is:inline />)}
